<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ThinkDrive</title>
    <base href="/" />
    <link rel="icon" href="/favicon.ico" />
    <link href="/manifest.webmanifest" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png" />
    <meta name="theme-color" content="#0b1b33" />

    <!-- SEO -->
    <meta name="description" content="ThinkDrive - Learn to drive with confidence. Accredited schools, easy registration, video lessons." />
    <meta name="keywords" content="driving schools, Ghana, ThinkDrive, driving lessons, registration" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />

    <!-- Icons -->
    <link href="lib/font-awesome/css/all.min.css" rel="stylesheet" />

    <!-- App Styles -->
    <link rel="stylesheet" href="/css/app.css" />
    <link rel="stylesheet" href="/css/layout.css" />
    <link rel="stylesheet" href="/css/home.css" />
    <link rel="stylesheet" href="/css/school.css" />
    <link rel="stylesheet" href="/css/videos.css" />
    <link rel="stylesheet" href="/css/register.css" />
    <link rel="stylesheet" href="/css/quiz.css" />
    <link rel="stylesheet" href="/css/schools.css" />
    <link rel="stylesheet" href="/css/mobile.css" />
    <link rel="stylesheet" href="/css/shorts.css" />
    <link rel="stylesheet" href="/css/loginforall.css" />

    <!-- Preload GIF for reliability -->
    <link rel="preload" as="image" href="/images/ThinkDrive.gif" />

    <!-- Inline loader CSS (ensures visible even if external CSS is delayed) -->
    <style>
        .thinkdrive-loader {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            background: #0b1b33 url("/images/ThinkDrive.gif") center center no-repeat;
            background-size: contain; /* keep GIF proportions */
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 300ms ease;
        }

            .thinkdrive-loader.hidden {
                opacity: 0;
                pointer-events: none;
            }

        .loader-overlay {
            position: relative;
            z-index: 2;
            text-align: center;
            color: #fff;
            font-family: 'Roboto', sans-serif;
            margin-bottom: 40px;
        }

        .loader-message {
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .loader-progress {
            width: 200px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 0 auto;
        }

        .loader-bar {
            height: 100%;
            width: 0%;
            background: #ffd700;
            transition: width 0.3s ease;
        }
        /* No-JS fallback */
        noscript .thinkdrive-loader {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="thinkdrive-loader" class="thinkdrive-loader">
        <div class="loader-overlay">
            <div class="loader-message">Loading ThinkDrive...</div>
            <div class="loader-progress">
                <div class="loader-bar" id="loader-bar"></div>
            </div>
        </div>
    </div>

    <div id="app">Loading...</div>

    <script>
        // Progress bar simulation (keeps users informed during WASM boot)
        (function () {
            let progress = 0;
            const bar = document.getElementById("loader-bar");
            const step = () => {
                progress = Math.min(progress + 8, 92); // cap before final hide
                bar.style.width = progress + "%";
            };
            const interval = setInterval(step, 250);
            window.addEventListener("load", () => {
                clearInterval(interval);
                bar.style.width = "100%";
                const loader = document.getElementById("thinkdrive-loader");
                loader.classList.add("hidden");
                setTimeout(() => loader.style.display = "none", 350);
            });
        })();
    </script>

    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Unified Interop -->
    <script src="js/thinkdriveInterop.js"></script>
    <script src="js/quizEffects.js"></script>

    <!-- Supabase Config -->
    <script>
        const supabaseUrl = "https://imdvnedpgeuegiwqjlwp.supabase.co";
        const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltZHZuZWRwZ2V1ZWdpd3FqbHdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0NTk1MTgsImV4cCI6MjA3OTAzNTUxOH0.oTHPLF0YnY1ET9VIiPfjdYsY-7oxnwuy5-L6ObSI1YA";
        window.supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);
        if (window.supabaseInterop?.init) {
            window.supabaseInterop.init(supabaseUrl, supabaseAnonKey);
        }
    </script>

    <!-- Dev-only: Unregister stale service workers -->
    <script>
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(regs => {
                    regs.forEach(r => {
                        try { r.unregister(); console.log('Unregistered SW:', r); } catch (e) { console.warn(e); }
                    });
                }).catch(e => console.warn('SW unregister failed', e));
            }
        }
    </script>

    <!-- Image preview helper -->
    <script>
        function previewHeroImage() {
            const input = document.getElementById("heroImageInput");
            const nameEl = document.getElementById("heroFileName");
            const previewEl = document.getElementById("heroPreview");

            if (input && input.files && input.files.length > 0) {
                const file = input.files[0];
                nameEl.textContent = file.name;

                const reader = new FileReader();
                reader.onload = function (e) {
                    previewEl.src = e.target.result;
                    previewEl.style.display = "block";
                };
                reader.readAsDataURL(file);
            } else {
                nameEl.textContent = "No file";
                previewEl.src = "";
                previewEl.style.display = "none";
            }
        }
    </script>

    <!-- Blazor Runtime -->
    <script src="_framework/blazor.webassembly.js"></script>
</body>
</html>
